# Docker APIコンテナ起動エラー（server.pid残留）対応レポート

## 1. 問題の概要
**症状**: `docker compose up` 実行時、APIコンテナが以下のエラーを出力して終了する。
```
A server is already running (pid: 1, file: /app/tmp/pids/server.pid).
```
**原因**: 前回のRailsサーバー終了処理（コンテナ停止）が正常に行われなかったため、プロセスIDファイル（`server.pid`）が削除されずに残ってしまった。Railsは起動時にこのファイルが存在すると「既に別のサーバーが起動中である」と判断して起動を中止する仕様のため。

## 2. 検討した対応策

### A案：エントリーポイントスクリプトの導入（推奨されたが未採用）
- **内容**: コンテナ起動時に毎回実行されるスクリプト（`bin/docker-entrypoint`）を設定し、その中で `rm -f /app/tmp/pids/server.pid` を実行する。
- **メリット**: 今後同様の強制終了が発生しても、次回起動時に自動的に修復される（恒久対策）。
- **デメリット**: 既存のファイル構成に変更が入る。

### B案：手動削除（採用）
- **内容**: ターミナルから直接 `rm` コマンドを実行してファイルを削除する。
- **メリット**: プロジェクトのファイル構成を変更しない。学習用リポジトリ（reference_backend）と構成を完全に一致させることができる。
- **デメリット**: 再発した場合は再度手動で削除する必要がある。

## 3. 実施内容と結果
今回は「学習用リポジトリ（reference_backend）の環境に準拠したい」という理由から、**B案（手動削除）**を採用しました。

### 実行コマンド
```bash
rm -f tmp/pids/server.pid
```

### 結果
PIDファイル削除後、`docker compose up` により正常にAPIコンテナが起動することを確認しました。
